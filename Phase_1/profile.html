<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title> SyncSpace â€¢ Profile</title>
  <link rel="stylesheet" href="css/styles.css"/>
</head>
<body>

  <!-- Topbar -->
  <div class="topbar">
    <div class="container topbar-inner">
    <div class="brand">
  <span class="mini" aria-hidden="true">

    <!-- SyncSpace Icon -->
    <svg viewBox="0 0 24 24">
      <path d="M17.65 6.35A7.95 7.95 0 0 0 12 4V1L7 6l5 5V7a5 5 0 1 1-5 5H5a7 7 0 1 0 12.65-5.65Z"/>
    </svg>
  </span>
  <span>SyncSpace</span>
</div>

      <div class="nav-links">
        <a href="feed.html">
          <svg viewBox="0 0 24 24"><path d="M12 3 3 10v11h6v-7h6v7h6V10l-9-7Z"/></svg>
          Home
        </a>
        <a href="users.html">
          <svg viewBox="0 0 24 24"><path d="M10 2a8 8 0 1 0 4.9 14.3l4.4 4.4 1.4-1.4-4.4-4.4A8 8 0 0 0 10 2Zm0 2a6 6 0 1 1 0 12 6 6 0 0 1 0-12Z"/></svg>
          Explore
        </a>
        <a class="active" href="profile.html">
          <svg viewBox="0 0 24 24"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.4 0-8 2.2-8 5v1h16v-1c0-2.8-3.6-5-8-5Z"/></svg>
          Profile
        </a>
      </div>

      <div class="user-pill">
        <span class="avatar" id="topAvatar">U</span>
        <span class="small" id="topUser">@user</span>
        <button class="btn btn-ghost" onclick="logout()">Logout</button>
      </div>
    </div>
  </div>

  <div class="app">
    <div class="container app-grid">
      <aside class="card sidebar">
        <div class="side-title">MENU</div>
        <a class="side-item" href="feed.html">
          <svg viewBox="0 0 24 24"><path d="M12 3 3 10v11h6v-7h6v7h6V10l-9-7Z"/></svg>
          Home
        </a>
        <a class="side-item" href="users.html">
          <svg viewBox="0 0 24 24"><path d="M10 2a8 8 0 1 0 4.9 14.3l4.4 4.4 1.4-1.4-4.4-4.4A8 8 0 0 0 10 2Zm0 2a6 6 0 1 1 0 12 6 6 0 0 1 0-12Z"/></svg>
          Explore
        </a>
        <a class="side-item active" href="profile.html">
          <svg viewBox="0 0 24 24"> <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.4 0-8 2.2-8 5v1h16v-1c0-2.8-3.6-5-8-5Z"/></svg>
          Profile
        </a>
      </aside>

      <main class="card main">
        <div class="page-title">
          <h1>Profile</h1>
          <div class="right">
            <a class="btn btn-ghost" href="feed.html">Back to Feed</a>
          </div>
        </div>

        <div class="card profile-hero">
          <span class="avatar" id="meAvatar">U</span>
          <div>
            <h2 id="meName">Name</h2>
            <div class="small muted" id="meHandle">@username</div>
            <div class="bio" id="meBio"></div>

            <div class="pills">
              <span title="Following">
                <svg viewBox="0 0 24 24"><path d="M16 11a4 4 0 1 0-4-4 4 4 0 0 0 4 4ZM6 11a4 4 0 1 0-4-4 4 4 0 0 0 4 4Zm10 2c-2.7 0-8 1.3-8 4v2h16v-2c0-2.7-5.3-4-8-4ZM6 13c-2.2 0-6 1.1-6 3.5V19h6v-2c0-1.5.6-2.8 1.8-3.8A10 10 0 0 0 6 13Z"/></svg>
                <span id="followingCount">0</span> Following
              </span>
            </div>
          </div>
        </div>

        <div class="hr"> </div>

        <div class="card form">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
            <h3>Edit Profile</h3>
            <button class="btn" id="saveBtn">Update</button>
          </div>

          <div class="form-grid" style="margin-top:12px;">
            <div>
              <label for="name">Name</label>
              <input class="input" id="name" />
            </div>
            <div>
              <label for="bio">Bio</label>
              <input class="input" id="bio" placeholder="Short bio..." />
            </div>
            <div>
              <label for="avatar">Profile picture URL (optional)</label>
              <input class="input" id="avatar" placeholder="https://...." />
              <div class="small muted" style="margin-top:6px;">
                If you leave it empty, it will show initials(like the UI screenshot).
              </div>
            </div>
          </div>
        </div>

      </main>
    </div>
  </div>

  <script src="js/storage.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/profile.js"></script>
  <script>
    const me = requireLogin();

    const topAvatar = document.getElementById("topAvatar");
    const topUser = document.getElementById("topUser");
    const meAvatar = document.getElementById("meAvatar");

    function renderAvatar(el, user){
      if (user.avatar){
        el.innerHTML = "";
        const img = document.createElement("img");
        img.src = user.avatar;
        el.appendChild(img);
      } else {
        el.textContent = initials(user.name);
      }
    }
    renderAvatar(topAvatar, me);
    renderAvatar(meAvatar, me);
    topUser.textContent = "@" + me.username;

    document.getElementById("meName").textContent = me.name;
    document.getElementById("meHandle").textContent = "@" + me.username;
    document.getElementById("meBio").textContent = me.bio || "";
    document.getElementById("followingCount").textContent = me.following.length;
         //
    //Fill form
    document.getElementById("name").value = me.name;
    document.getElementById("bio").value = me.bio || "";
    document.getElementById("avatar").value = me.avatar || "";

    document.getElementById("saveBtn").onclick = () => {
      try{
        updateProfile({
          name: document.getElementById("name").value,
          bio: document.getElementById("bio").value,
          avatar: document.getElementById("avatar").value
        });
        //Reload to reflect changes
        window.location.reload();
      }catch(e){
        alert(e.message);
      }
    };
  </script>
</body>
</html>